# GitHub Copilot Instructions for cat-play-mml

## Repository Overview

This is a Music Macro Language (MML) parser and player project with multi-language implementations. The primary goal is to parse MML text (e.g., "cde" for Do-Re-Mi) and play music in real-time.

### Project Structure

```
cat-play-mml/
├── src/
│   ├── python/          # Python implementation (primary)
│   ├── rust/            # Rust implementation (planned)
│   ├── go/              # Go implementation (planned)
│   └── typescript/      # TypeScript implementations (planned)
├── tests/               # Test files
├── grammar/             # tree-sitter grammar definitions
├── docs/                # Documentation
├── requirements.txt     # Python dependencies
├── pytest.ini          # pytest configuration
└── ruff.toml           # Ruff linter/formatter configuration
```

## Development Environment Setup

### Python Setup

1. **Python Version**: Requires Python 3.8+
2. **Install Dependencies**:
   ```bash
   pip install -r requirements.txt
   ```
3. **Install Development Tools**:
   ```bash
   pip install ruff pytest
   ```

## Code Quality Tools

### Linting and Formatting

This project uses [ruff](https://docs.astral.sh/ruff/) for code quality:

```bash
# Format code
ruff format src/ tests/

# Run linter checks
ruff check src/ tests/

# Auto-fix linting issues
ruff check --fix src/ tests/
```

**Configuration**: See `ruff.toml` for project-specific settings:
- Line length: 120 characters
- Uses double quotes for strings
- Unix line endings (LF)
- Enabled rules: pycodestyle (E), Pyflakes (F), warnings (W), isort (I)

### Testing

Run tests using pytest:

```bash
# Run all tests
pytest

# Run with verbose output
pytest -v

# Run specific test file
pytest tests/test_specific.py
```

**Configuration**: See `pytest.ini` for test configuration.

## Project-Specific Conventions

### Code Style

1. **Line Length**: Maximum 120 characters
2. **Quotes**: Use double quotes for strings
3. **Imports**: Follow isort conventions, with `src` treated as first-party
4. **Type Hints**: Encouraged for Python code

### MML Syntax Support

The project implements basic MML (Music Macro Language) parsing:

- **Notes**: `c`, `d`, `e`, `f`, `g`, `a`, `b` (Do, Re, Mi, Fa, Sol, La, Si)
- **Octave**: `o4` (set to 4th octave), `>` (octave up), `<` (octave down)
- **Length**: `l4` (quarter note)
- **Tempo**: `t120` (BPM 120)
- **Accidentals**: `+`, `#` (sharp), `-` (flat)
- **Rest**: `r` (rest/silence)

### Audio Processing

- **Primary Library**: sounddevice + numpy for Python
- **Waveform Generation**: Simple sine wave synthesis
- **Reference Frequency**: A4 = 440Hz
- **Sample Rate**: 44100Hz (standard)

## Multi-Language Implementation

This project aims to implement the same MML player in multiple languages:

1. **Python** (primary/reference implementation)
2. **Rust** (planned - using cpal for audio)
3. **Go** (planned - using oto for audio)
4. **TypeScript/Browser** (planned - using Web Audio API)
5. **TypeScript/Deno** (planned - using FFI or WASM)

See `src/IMPLEMENTATION_PLAN_SUMMARY.md` for detailed plans.

## Running the Application

### Python Version

```bash
# Play a simple melody
python src/python/play_mml.py "cde"

# More complex example
python src/python/play_mml.py "t120 o4 cdefgab>c"
```

## Project Goals and Scope

### Goals

- Verify that MML parser implementation can be generated by LLM chatbots
- Validate simple implementation approaches in each language
- Test LLM agent portability across languages

### Out of Scope

- Complex MML extensions (macros, loops)
- MIDI output
- Audio effects processing
- GUI editor

## Best Practices for Contributors

1. **Make Minimal Changes**: Modify only what's necessary to address the issue
2. **Test Before Committing**: Always run linting and tests before pushing
3. **Document Changes**: Update README and relevant docs for user-facing changes
4. **Follow Existing Patterns**: Match the coding style of existing files
5. **Keep It Simple**: This project prioritizes simplicity and clarity over advanced features

## Common Commands Reference

```bash
# Lint and format code
ruff format src/ tests/
ruff check --fix src/ tests/

# Run tests
pytest

# Run the Python implementation
python src/python/play_mml.py "cde"

# Check git status
git status
```

## Important Notes

- The project uses `.editorconfig` for consistent editor settings
- Python is the reference implementation; other languages should follow its behavior
- Focus on educational clarity rather than production optimization
- All implementations should support the basic "cde" example as a minimum
