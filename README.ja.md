# cat-play-mml

ðŸŽµ Music Macro Language (MML) Parser and Player

## çŠ¶æ³

ã¾ã agentã«ç”Ÿæˆã•ã›ãŸç›´å¾Œã§ã™

ã“ã‚Œã‹ã‚‰å‹•ä½œç¢ºèªã—ã¾ã™

## æ¦‚è¦

`cat-play-mml` ã¯ã€Music Macro Language (MML) ã‚’è§£æžã—ã¦éŸ³æ¥½ã‚’å†ç”Ÿã™ã‚‹ãƒžãƒ«ãƒè¨€èªžå¯¾å¿œã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚tree-sitterã‚’ä½¿ç”¨ã—ã¦MMLã‚’ASTã«ãƒ‘ãƒ¼ã‚¹ã—ã€å„è¨€èªžã§ä¸­é–“è¡¨ç¾ã«å¤‰æ›ã—ã¦éŸ³æ¥½ã‚’å†ç”Ÿã—ã¾ã™ã€‚

### ä¸»ãªç‰¹å¾´

- **MMLãƒ‘ãƒ¼ã‚µãƒ¼**: tree-sitterãƒ™ãƒ¼ã‚¹ã®MMLæ–‡æ³•å®šç¾©
- **ãƒžãƒ«ãƒè¨€èªžå¯¾å¿œ**: Pythonã€Rustã€Goã€TypeScriptï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ç‰ˆãƒ»Denoç‰ˆï¼‰ã§ã®å®Ÿè£…
- **ä½Žãƒ¬ã‚¤ãƒ†ãƒ³ã‚·**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³æ¥½å†ç”Ÿ
- **ã‚·ãƒ³ãƒ—ãƒ«ãªAPI**: å¼•æ•°ã«"cde"ã‚’æ¸¡ã™ã ã‘ã§ãƒ‰ãƒ¬ãƒŸã‚’å†ç”Ÿ

## ãƒ‡ãƒ¢

MMLæ–‡å­—åˆ—ã§éŸ³æ¥½ã‚’è¡¨ç¾ã—ã¾ã™ï¼š

```bash
# ãƒ‰ãƒ¬ãƒŸã‚’å†ç”Ÿ
python src/python/play_mml.py "cde"

# ã‚ˆã‚Šè¤‡é›‘ãªä¾‹
python src/python/play_mml.py "t120 o4 cdefgab>c"
```

## MML (Music Macro Language) ã¨ã¯

MMLã¯ã€ãƒ†ã‚­ã‚¹ãƒˆã§éŸ³æ¥½ã‚’è¨˜è¿°ã™ã‚‹è¨€èªžã§ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ãªè¨˜æ³•ã‚’ä½¿ç”¨ã—ã¾ã™ï¼š

- `c`, `d`, `e`, `f`, `g`, `a`, `b`: éŸ³éšŽï¼ˆãƒ‰ã€ãƒ¬ã€ãƒŸã€ãƒ•ã‚¡ã€ã‚½ã€ãƒ©ã€ã‚·ï¼‰
- `o4`: ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–è¨­å®šï¼ˆ4ç•ªç›®ã®ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ï¼‰
- `l4`: éŸ³é•·è¨­å®šï¼ˆ4åˆ†éŸ³ç¬¦ï¼‰
- `t120`: ãƒ†ãƒ³ãƒè¨­å®šï¼ˆBPM 120ï¼‰
- `>`, `<`: ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ã®ä¸Šã’ä¸‹ã’
- `+`, `#`, `-`: åŠéŸ³ä¸Šã’ä¸‹ã’
- `r`: ä¼‘ç¬¦

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### å¿…è¦ãªç’°å¢ƒ

- Python 3.8+
- pip

### Pythonãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
pip install -r requirements.txt
```

## ä½¿ç”¨æ–¹æ³•

### Pythonç‰ˆ

```bash
python src/python/play_mml.py "cde"
```

### Rustç‰ˆï¼ˆå®Ÿè£…äºˆå®šï¼‰

```bash
cd src/rust
cargo run -- "cde"
```

### Goç‰ˆï¼ˆå®Ÿè£…äºˆå®šï¼‰

```bash
cd src/go
go run main.go "cde"
```

### TypeScriptç‰ˆï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ç‰ˆãƒ»å®Ÿè£…äºˆå®šï¼‰

```bash
cd src/typescript/browser
npm install
npm run dev
```

### TypeScriptç‰ˆï¼ˆDenoç‰ˆãƒ»å®Ÿè£…äºˆå®šï¼‰

```bash
cd src/typescript/deno
deno run --allow-all main.ts "cde"
```

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
cat-play-mml/
â”œâ”€â”€ LICENSE                 # MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹
â”œâ”€â”€ README.md              # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ pytest.ini            # pytestè¨­å®š
â”œâ”€â”€ ruff.toml              # ã‚³ãƒ¼ãƒ‰å“è³ªãƒ„ãƒ¼ãƒ«è¨­å®š
â”œâ”€â”€ requirements.txt       # Pythonä¾å­˜é–¢ä¿‚
â”œâ”€â”€ .editorconfig         # ã‚¨ãƒ‡ã‚£ã‚¿è¨­å®š
â”œâ”€â”€ grammar/              # tree-sitteræ–‡æ³•å®šç¾©
â”‚   â””â”€â”€ mml/             # MMLæ–‡æ³•
â”œâ”€â”€ docs/                 # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”œâ”€â”€ tests/                # ãƒ†ã‚¹ãƒˆ
â””â”€â”€ src/
    â”œâ”€â”€ python/           # Pythonå®Ÿè£…
    â”‚   â”œâ”€â”€ play_mml.py  # ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚°ãƒ©ãƒ 
    â”‚   â”œâ”€â”€ mml_parser.py # MMLãƒ‘ãƒ¼ã‚µãƒ¼
    â”‚   â””â”€â”€ audio_player.py # ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå†ç”Ÿ
    â”œâ”€â”€ rust/             # Rustå®Ÿè£…ï¼ˆäºˆå®šï¼‰
    â”‚   â”œâ”€â”€ Cargo.toml
    â”‚   â””â”€â”€ src/
    â”œâ”€â”€ go/               # Goå®Ÿè£…ï¼ˆäºˆå®šï¼‰
    â”‚   â”œâ”€â”€ go.mod
    â”‚   â””â”€â”€ main.go
    â”œâ”€â”€ typescript/       # TypeScriptå®Ÿè£…ï¼ˆäºˆå®šï¼‰
    â”‚   â”œâ”€â”€ browser/     # ãƒ–ãƒ©ã‚¦ã‚¶ç‰ˆ
    â”‚   â””â”€â”€ deno/        # Denoç‰ˆ
    â””â”€â”€ IMPLEMENTATION_PLAN_SUMMARY.md
```

## æŠ€è¡“è©³ç´°

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

1. **ãƒ‘ãƒ¼ã‚µãƒ¼**: tree-sitterã‚’ä½¿ç”¨ã—ã¦MMLãƒ†ã‚­ã‚¹ãƒˆã‚’ASTã«å¤‰æ›
2. **ä¸­é–“è¡¨ç¾**: ASTã‚’å„è¨€èªžã®éŸ³æ¥½ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã«å¤‰æ›
3. **ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªç”Ÿæˆ**: ä¸­é–“è¡¨ç¾ã‹ã‚‰éŸ³å£°æ³¢å½¢ã‚’ç”Ÿæˆ
4. **å†ç”Ÿ**: ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦éŸ³å£°ã‚’å‡ºåŠ›

### ä½¿ç”¨ã™ã‚‹ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ©ã‚¤ãƒ–ãƒ©ãƒª

- **Python**: sounddevice + numpy
- **Rust**: cpal (äºˆå®š)
- **Go**: oto (äºˆå®š)
- **TypeScript (Browser)**: Web Audio API (äºˆå®š)
- **TypeScript (Deno)**: FFIçµŒç”±ã§ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ©ã‚¤ãƒ–ãƒ©ãƒª (äºˆå®š)

## é–‹ç™º

### ã‚³ãƒ¼ãƒ‰å“è³ªã®ç¶­æŒ

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ [ruff](https://docs.astral.sh/ruff/) ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ¼ãƒ‰å“è³ªã‚’ç¶­æŒã—ã¦ã„ã¾ã™ã€‚

```bash
# ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆ
ruff format src/ tests/

# ãƒªãƒ³ãƒˆãƒã‚§ãƒƒã‚¯
ruff check src/ tests/

# è‡ªå‹•ä¿®æ­£å¯èƒ½ãªå•é¡Œã‚’ä¿®æ­£
ruff check --fix src/ tests/
```

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# Python
pytest

# Rust
cd src/rust && cargo test

# Go
cd src/go && go test ./...
```

## ä»Šå¾Œã®äºˆå®š

- [x] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸæ§‹æˆ
- [ ] tree-sitter MMLæ–‡æ³•å®šç¾©ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- [x] Pythonå®Ÿè£…
- [ ] Rustå®Ÿè£… - [å®Ÿè£…è¨ˆç”»æ›¸](src/rust/IMPLEMENTATION_PLAN.md)
- [ ] Goå®Ÿè£… - [å®Ÿè£…è¨ˆç”»æ›¸](src/go/IMPLEMENTATION_PLAN.md)
- [ ] TypeScriptï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ç‰ˆï¼‰å®Ÿè£… - [å®Ÿè£…è¨ˆç”»æ›¸](src/typescript/browser/IMPLEMENTATION_PLAN.md)
- [ ] TypeScriptï¼ˆDenoç‰ˆï¼‰å®Ÿè£… - [å®Ÿè£…è¨ˆç”»æ›¸](src/typescript/deno/IMPLEMENTATION_PLAN.md)

**å®Ÿè£…è¨ˆç”»ã®è©³ç´°**: [å®Ÿè£…è¨ˆç”»æ›¸ã‚µãƒžãƒªãƒ¼](src/IMPLEMENTATION_PLAN_SUMMARY.md)ã‚’ã”è¦§ãã ã•ã„ã€‚

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚´ãƒ¼ãƒ«

- MMLãƒ‘ãƒ¼ã‚µãƒ¼ã®å®Ÿè£…ã‚’LLM chatbotã§ç”Ÿæˆã§ãã‚‹ã‹æ¤œè¨¼ã™ã‚‹
- å„è¨€èªžã§ã‚·ãƒ³ãƒ—ãƒ«ãªå®Ÿè£…ãŒå¯èƒ½ã‹æ¤œè¨¼ã™ã‚‹
- å„è¨€èªžã§LLM agentã«ã‚ˆã‚‹ç§»æ¤ãŒå¯èƒ½ã‹æ¤œè¨¼ã™ã‚‹

## ã‚¹ã‚³ãƒ¼ãƒ—å¤–

- è¤‡é›‘ãªMMLæ‹¡å¼µæ§‹æ–‡ï¼ˆãƒžã‚¯ãƒ­ã€ãƒ«ãƒ¼ãƒ—ãªã©ï¼‰
- MIDIå‡ºåŠ›
- ã‚¨ãƒ•ã‚§ã‚¯ãƒˆå‡¦ç†
- GUI ã‚¨ãƒ‡ã‚£ã‚¿

## é–¢é€£ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

### cat-play-chord æ¤œè¨Žä¸­

[cat-play-chord](https://github.com/cat2151/cat-play-chord) ã¯ã€chord2mmlã‚’åˆ©ç”¨ã—ã¦ã‚³ãƒ¼ãƒ‰è¡¨è¨˜ã‹ã‚‰MMLã‚’ç”Ÿæˆã—ã¦æ¼”å¥ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã™ï¼ˆæ¤œè¨Žä¸­ï¼‰ã€‚

### mml to smf æ¤œè¨Žä¸­
- ä»¥ä¸‹ã®passã‚’æƒ³å®š
  - mml to CST by tree-sitter
  - CST to ä¸­é–“è¡¨ç¾
  - ä¸­é–“è¡¨ç¾ to ä¸­é–“è¡¨ç¾ â€»nå›ž
  - ä¸­é–“è¡¨ç¾ to SMF â€»SMFã‚’textã§è¡¨ç¾ã—ãŸjson to SMF ã®æƒ³å®š
- MMLæ–¹è¨€ã¯mmlabcã‚’ä½¿ã†æƒ³å®šã€ãƒŽã‚¦ãƒã‚¦ãŒã‚ã‚Šã€formatãŒæ˜Žç¢º
- SMFã‚’ä½¿ã†ã“ã¨ã§ç¢ºèªã¨é–‹ç™ºãŒã—ã‚„ã™ããªã‚Šã€é–‹ç™ºãŒé “æŒ«ã™ã‚‹ãƒªã‚¹ã‚¯ã‚’ä¸‹ã’ã‚‰ã‚Œã‚‹æƒ³å®š
- Linux Python TDD agent ã§é€²ã‚ã‚‹æƒ³å®šã€ãƒãƒ«ã‚·ãƒãƒ¼ã‚·ãƒ§ãƒ³ãŒå‡ºãŸã‚‰æ¤œè¨Žã™ã‚‹

### smf to Nuked-OPM friendly JSON æ¤œè¨Žä¸­
- ä¾‹
  - ãƒ‡ã‚£ãƒ¬ã‚¤ãƒ“ãƒ–ãƒ©ãƒ¼ãƒˆ
    - tone settings toml ã® tone modify delay vibratoã®å€¤ã‚’å…ƒã«ã€
      - OPMã‚µã‚¦ãƒ³ãƒ‰ãƒ‰ãƒ©ã‚¤ãƒçš„ã«ã€
        - 1tickã”ã¨ã«ã‚½ãƒ•ãƒˆLFOã®register eventã‚’ç”Ÿæˆ
    - SMFã¨tomlã‚’åˆ†é›¢ã™ã‚‹ã®ã¯ã€SMFå´ã®MIDIã‚¤ãƒ³ãƒ—ãƒªãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«ã™ã‚‹ç”¨
      - tomlå´ã§éŸ³è‰²ã‚„OPMã‚µã‚¦ãƒ³ãƒ‰ãƒ‰ãƒ©ã‚¤ãƒçš„å‡¦ç†ã®ç ´å£Šçš„å¤‰æ›´ã‚’ã—ã‚„ã™ããªã‚‹ã€ETCåŽŸå‰‡
- ä»¥ä¸‹ã®passã‚’æƒ³å®š
  - SMF to ä¸­é–“è¡¨ç¾ â€»SMFã‚’textã§è¡¨ç¾ã—ãŸjsonã‚’æƒ³å®š
  - ä¸­é–“è¡¨ç¾ to ä¸­é–“è¡¨ç¾ â€»nå›ž â€»ãƒ‡ã‚£ãƒ¬ã‚¤ãƒ“ãƒ–ãƒ©ãƒ¼ãƒˆã¯ã“ã“ã®æƒ³å®š
  - ä¸­é–“è¡¨ç¾ to Nuked-OPM friendly JSON
- Linux Python TDD agent ã§é€²ã‚ã‚‹æƒ³å®šã€ãƒãƒ«ã‚·ãƒãƒ¼ã‚·ãƒ§ãƒ³ãŒå‡ºãŸã‚‰æ¤œè¨Žã™ã‚‹

### Nuked-OPM friendly JSON player æ¤œè¨Žä¸­
- ç”¨é€”ã¯ã€é–‹ç™ºã‚’ã—ã‚„ã™ãã™ã‚‹ç”¨
- ã“ã‚Œãªã‚‰ãƒ‡ãƒãƒƒã‚°ã—ã‚„ã™ãã€é–‹ç™ºãŒé “æŒ«ã™ã‚‹ãƒªã‚¹ã‚¯ã‚’ä¸‹ã’ã‚‰ã‚Œã‚‹æƒ³å®š
- äººåŠ›ã§ã‚„ã‚‹æƒ³å®šã€agentã§ã¯TDDå›°é›£ãªãŸã‚ãƒãƒ«ã‚·ãƒãƒ¼ã‚·ãƒ§ãƒ³ãŒå¤šã„æƒ³å®š

### ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ  FM tone editor ä»® æ¤œè¨Žä¸­
- ã“ã“ã«æ›¸ãç›®çš„
  - ãƒ©ãƒãƒ¼ãƒ€ãƒƒã‚­ãƒ³ã‚°
- ç”¨é€”
  - æ¤œè¨¼ç”¨
- å„ªå…ˆé †ä½
  - é–‹ç™ºã®æ¥½ã•ã¨ã€å°‘ãªã„æ“ä½œã§éŸ³è‰²ã®ãƒ©ãƒ•ã‚¹ã‚±ãƒƒãƒã‚’ã™ã‚‹ç”¨é€”ã€ã‚’å„ªå…ˆ
- æ“ä½œ
  - å³æ‰‹ : mouse x,yã§ãã‚Œãžã‚Œã«ã‚¢ã‚µã‚¤ãƒ³ã—ãŸæ•°å€¤ã®å¢—æ¸›
  - å·¦æ‰‹ : WASD+QEã§ã‚«ãƒ¼ã‚½ãƒ«ç§»å‹•ã€SPACEã§æ±ºå®šã€ESCã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€Zã§UNDOã€ãµã‚ã£ã¨ã—ã¦ã„ã‚‹
  - x,yã¯ã€DecayRate, ModulatorTL, FB, MULã‚’ã‚«ãƒ¼ã‚½ãƒ«ç§»å‹•ã§åˆ‡ã‚Šæ›¿ãˆ
  - WASD+QEã€UNDOã€ã¯ãµã‚ã£ã¨ã—ã¦ã„ã‚‹
  - ã‚«ãƒ¼ã‚½ãƒ«ç§»å‹•ã¨æ±ºå®šã€ã®ã‹ã‚ã‚Šã«ã€ã‚ã‚‹ã‚­ãƒ¼ã‚’æŠ¼ã™ã¨ä¸€ç™ºã§åŠ¹æžœãŒå‡ºã¦é«˜é€Ÿeditã§ãã‚‹ã€ã®ã»ã†ãŒeditã‚¹ãƒ”ãƒ¼ãƒ‰ã¯å‡ºã‚‹ã®ã§ãã‚Œã‚‚è©¦ã™ã€è¨­å®štomlãƒ•ã‚¡ã‚¤ãƒ«ã¨ã‹
- éŸ³
  - éŸ³è‰²ã¯pluckã¨ãƒ­ãƒ³ã‚°ãƒˆãƒ¼ãƒ³ã‚’ã‚«ãƒ¼ã‚½ãƒ«ç§»å‹•ã§åˆ‡ã‚Šæ›¿ãˆ
  - OPæŽ¥ç¶šã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯2opä¸¦åˆ—ã€detuneã¯4ã¤åˆ¥ã®å€¤
- è¡¨ç¤º
  - Windows TUI 80x24
  - éŸ³è‰²ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¡¨ç¤ºã¯mdx note.xå½¢å¼
  - èµ·å‹•ä¸­ã¯ã€æœ€å¾Œã®æ•°å€¤å¤‰æ›´ã‹ã‚‰1ç§’ã§ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«mdx note.xå½¢å¼ã§éŸ³è‰²ä¿å­˜ã€å‡ºåŠ›ã¯ã“ã‚Œã ã‘ã«çµžã‚‹ã€ä»®
- ã™ã¹ã¦ã®ä»•æ§˜ã¯ä»®ã§ã€ç ´å£Šçš„å¤‰æ›´ã‚’é »ç¹ã«è¡Œã†ã€é–‹ç™ºãŒæ¥½ãªã“ã¨ã‚’å„ªå…ˆ
- ã“ã‚Œã ã‘ã§ã‚‚ã¾ã ä»•æ§˜ãŒå¤šã™ãŽã‚‹ï¼ˆå°ã•ãå§‹ã‚ã‚‹ã«ã¯å¤šã™ãŽã‚‹ï¼‰ã®ã§ã€ã‚‚ã£ã¨çµžã£ãŸä»•æ§˜ã§ã®ä»®ã®å®Ÿè£…ã‹ã‚‰å°ã•ãå§‹ã‚ã‚‹

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ [MIT License](LICENSE) ã®ä¸‹ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚
