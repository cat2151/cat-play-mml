Last updated: 2025-11-28

# Project Overview

## プロジェクト概要
- Music Macro Language (MML) を解析し、テキスト形式で記述された音楽を再生するCLIツールです。
- Windows環境に特化しており、シンプルなコマンド入力でMMLをリアルタイムで演奏できます。
- 低レイテンシな応答性と、バックグラウンドでの安定した音楽再生が特徴です。

## 技術スタック
- フロントエンド: コマンドラインインターフェース (CLI) - ユーザーが直接テキストコマンドで操作するインターフェースを提供します。
- 音楽・オーディオ:
    - Music Macro Language (MML): 音楽をテキストで記述するための言語です。
    - Nuked-OPM: 音源エミュレーションに関する技術です。
    - cpal: クロスプラットフォームでオーディオ入出力を行うためのRustライブラリです。
    - ALSA SDK: (開発環境として) Linux環境でオーディオのテストを行うためのSDKです。
    - Standard MIDI File (SMF): (将来的に) 音楽データを標準的な形式で出力するためのファイルフォーマットです。
- 開発ツール:
    - Rust: 高性能かつ安全なシステムプログラミング言語です。
    - Cargo: Rustのプロジェクト管理およびビルドツールです。
    - tree-sitter: 高速なパーサーを生成し、MMLテキストを構文木に変換するために使用されます。
    - Visual Studio Code: 開発に使用される統合開発環境 (IDE) です。
- テスト: TDD (Test Driven Development) - テスト駆動開発手法を採用し、品質向上と堅牢なコードベースを目指します。
- ビルドツール: Cargo - Rustプロジェクトのビルド、依存関係管理、テスト実行を効率的に行います。
- 言語機能: (特になし)
- 自動化・CI/CD: GitHub Actions - READMEの自動翻訳など、CI/CDパイプラインに利用されます。
- 開発標準: EditorConfig - 異なるエディタやIDE間でコードのスタイルを統一するための設定ファイルです。

## ファイル階層ツリー
```
📄 .editorconfig
📄 .gitignore
📁 .vscode/
  📊 extensions.json
  📊 settings.json
📄 Cargo.lock
📄 Cargo.toml
📄 LICENSE
📖 README.ja.md
📖 README.md
📄 _config.yml
📁 generated-docs/
📁 issue-notes/
  📖 31.md
📁 src/
  📄 app.rs
  📄 cli.rs
  📄 client_manager.rs
  📄 converter.rs
  📄 input.rs
  📄 main.rs
```

## ファイル詳細説明
-   `.editorconfig`: 異なるエディタやIDEで作業する開発者間で、インデントスタイルや文字コードなどのコードスタイルを統一するための設定ファイルです。
-   `.gitignore`: Gitバージョン管理システムにおいて、リポジトリに含めないファイルやディレクトリ（例: ビルド成果物、一時ファイルなど）を指定するファイルです。
-   `.vscode/`: Visual Studio Codeエディタ用の設定を格納するディレクトリです。
    -   `extensions.json`: プロジェクト推奨のVS Code拡張機能リストです。
    -   `settings.json`: VS Codeのワークスペース固有の設定（例: フォーマッタ、リンター設定）を定義するファイルです。
-   `Cargo.lock`: `Cargo.toml`で指定された依存関係の正確なバージョンとチェックサムを記録し、ビルドの再現性を保証するファイルです。
-   `Cargo.toml`: Rustプロジェクトのマニフェストファイルで、プロジェクト名、バージョン、依存関係、ビルド設定などを定義します。
-   `LICENSE`: プロジェクトのライセンス情報（MIT License）を記載したファイルです。
-   `README.ja.md`: プロジェクトの概要、使い方、特徴などを日本語で記述した主要な説明書ファイルです。
-   `README.md`: `README.ja.md`を元に自動生成された、プロジェクトの英語の説明書ファイルです。
-   `_config.yml`: GitHub PagesのJekyll設定ファイルである可能性が高いです。
-   `generated-docs/`: 自動生成されたドキュメントを格納するディレクトリです（例: 開発状況レポート）。
-   `issue-notes/`: 開発中の課題や検討事項に関するメモを格納するディレクトリです。
    -   `31.md`: 特定の課題に関する詳細なメモや議論が記述されたMarkdownファイルです。
-   `src/`: ソースコードを格納するディレクトリです。
    -   `app.rs`: アプリケーションの主要なロジックやコア機能が定義されている可能性のあるファイルです。
    -   `cli.rs`: コマンドラインインターフェースの解析や処理に関するロジックが定義されているファイルです。コマンドライン引数の解釈などを担当します。
    -   `client_manager.rs`: サーバーモードで動作する際に、クライアントからのリクエストを管理・処理するロジックが定義されているファイルです。
    -   `converter.rs`: MMLテキストを内部の音楽データ構造に変換する、あるいは中間表現を生成するロジックが定義されているファイルです。パーサーの出力とオーディオ生成の中間を担います。
    -   `input.rs`: ユーザーからのMML入力やその他のコマンド入力に関する処理を扱うファイルです。
    -   `main.rs`: プロジェクトのエントリーポイントとなるファイルです。アプリケーションの起動処理、CLI引数の受け取り、主要なコンポーネントの初期化と実行フローを管理します。

## 関数詳細説明
-   `main` (src/main.rs内): アプリケーションのエントリーポイント関数です。
    -   **引数**: コマンドライン引数
    -   **戻り値**: なし (またはアプリケーション終了ステータス)
    -   **機能**: アプリケーションの初期化、CLI引数の解釈、適切な処理フロー（MML再生、サーバー起動、停止、シャットダウン）のディスパッチを行います。
-   `handle_cli_args` (src/cli.rs内、またはmain.rsから呼び出される): コマンドライン引数を解析し、実行すべきアクション（例: MML再生、サーバー起動、停止、シャットダウン）を特定します。
    -   **引数**: コマンドライン引数のリスト
    -   **戻り値**: 解析されたコマンドとパラメータ
    -   **機能**: ユーザーが入力したコマンドライン引数を構造化されたデータに変換し、メインロジックが処理しやすい形式で提供します。
-   `parse_mml` (src/converter.rs内、または関連モジュール内): 与えられたMML文字列を解析し、内部で使用される音楽データ構造（ASTや中間表現）に変換します。
    -   **引数**: MML文字列
    -   **戻り値**: 音楽データの中間表現
    -   **機能**: Music Macro Languageの文法に従ってテキストを構文解析し、後続のオーディオ生成処理で利用可能な形式に変換します。
-   `convert_to_audio_data` (src/converter.rs内、または関連モジュール内): 音楽データの中間表現から、オーディオライブラリ（cpalなど）が再生できる具体的な音声波形データを生成します。
    -   **引数**: 音楽データの中間表現
    -   **戻り値**: オーディオ再生可能なバイナリ波形データ
    -   **機能**: 音楽イベント（音符、休符、テンポなど）を解釈し、指定された音源（Nuked-OPMなど）を用いて時間軸上の音声信号を生成します。
-   `play_audio` (src/app.rsまたは関連モジュール内): 生成された音声波形データをシステムのオーディオ出力デバイスを通して再生します。
    -   **引数**: オーディオ再生可能なバイナリ波形データ
    -   **戻り値**: なし
    -   **機能**: cpalライブラリなどのオーディオAPIを利用して、合成された音楽をユーザーのスピーカーやヘッドフォンに出力します。
-   `start_server` (src/client_manager.rs内、または関連モジュール内): バックグラウンドで動作するサーバープロセスを起動し、クライアントからのMMLデータや制御コマンドを受信できるようにします。
    -   **引数**: なし
    -   **戻り値**: なし
    -   **機能**: ネットワーク通信を介して他のプロセスからのリクエストを待ち受け、受信したMMLの解析・再生、または停止・シャットダウン処理を実行します。
-   `send_to_server` (src/client_manager.rs内、または関連モジュール内): クライアントモードで、既に起動しているサーバーに対してMMLデータや制御コマンドを送信します。
    -   **引数**: 送信するMML文字列またはコマンド
    -   **戻り値**: なし
    -   **機能**: サーバーと通信プロトコルを用いてデータを交換し、バックグラウンドサーバーに音楽再生やその他の制御を指示します。
-   `stop_playback` (src/client_manager.rs内、または関連モジュール内): 現在サーバーで再生中の音楽を停止する処理を行います。
    -   **引数**: なし
    -   **戻り値**: なし
    **機能**: サーバーに再生停止コマンドを送信し、実行中の音楽ストリームを中断させます。
-   `shutdown_server` (src/client_manager.rs内、または関連モジュール内): 起動中のサーバープロセスを安全に終了させる処理を行います。
    -   **引数**: なし
    -   **戻り値**: なし
    -   **機能**: サーバーにシャットダウンコマンドを送信し、リソースを解放してプロセスを終了させます。

## 関数呼び出し階層ツリー
```
提供された情報では、具体的な関数呼び出し階層を分析できませんでした。
このプロジェクトは、コマンドライン引数に基づいてMMLの解析、オーディオ生成、再生、またはバックグラウンドサーバーとの通信を行う構造になっています。
一般的なRust CLIアプリケーションの概念的なエントリポイントは `main` 関数であり、そこからCLI引数の解析を経て、各機能（MML再生、サーバー制御など）が呼び出される流れが推測されます。

---
Generated at: 2025-11-28 07:03:38 JST
