Last updated: 2025-11-18

# Project Overview

## プロジェクト概要
- Music Macro Language (MML) を使って音楽を再生するWindows用のCLIツールです。
- 簡単なMML文字列を入力するだけで、すぐに音楽を演奏することができます。
- リアルタイムでの低レイテンシ再生と、バックグラウンドでの演奏が可能です。

## 技術スタック
- フロントエンド: このプロジェクトはコマンドラインインターフェース（CLI）ツールであり、グラフィカルなユーザーインターフェース（GUI）は持ちません。
- 音楽・オーディオ:
    - Nuked-OPM: ヤマハFM音源のYM2151チップをエミュレートし、高品質な音楽合成を行うためのライブラリです。
    - cpal: Rustでオーディオ入出力を扱うためのクロスプラットフォームライブラリで、リアルタイムな音声再生を実現します。
    - MML (Music Macro Language): テキスト形式で音楽を記述するための言語です。このプロジェクトでは、MML文字列を解析して音楽を再生します。
- 開発ツール:
    - Rust: 高性能かつ安全なシステムプログラミング言語で、本プロジェクトの主要な実装言語です。
    - Zig cc: RustプロジェクトがC言語で書かれたライブラリと連携する際に使用されるC/C++コンパイラです。
    - tree-sitter: MMLテキストを解析し、プログラムが理解できる構造（抽象構文木）に変換するためのパーサー生成ツールです。
- テスト:
    - TDD agent: テスト駆動開発を支援するエージェントツールで、開発効率と品質向上に貢献します。
- ビルドツール:
    - Cargo: Rust言語のパッケージマネージャーおよびビルドシステムです。依存関係の管理とプロジェクトのビルドを行います。
- 言語機能:
    - Rust言語そのものが持つ強力な機能と型安全性が、本プロジェクトの安定性とパフォーマンスを支えています。
- 自動化・CI/CD:
    - GitHub Actions: コードの変更があった際に自動的にテストやビルド、ドキュメントの生成などを実行する継続的インテグレーション/デリバリーサービスです。
- 開発標準:
    - MIT License: プロジェクトの利用、複製、改変、配布に関する許諾条件を定めたオープンソースライセンスです。

## ファイル階層ツリー
```
📄 .editorconfig
📄 .gitignore
📁 .vscode/
  📊 extensions.json
  📊 settings.json
📄 Cargo.lock
📄 Cargo.toml
📄 LICENSE
📖 README.ja.md
📖 README.md
📄 _config.yml
📁 generated-docs/
📁 src/
  📄 app.rs
  📄 cli.rs
  📄 client_manager.rs
  📄 converter.rs
  📄 input.rs
  📄 main.rs
  📄 process_manager.rs
```

## ファイル詳細説明
- **`.editorconfig`**: さまざまなエディタやIDE間でコーディングスタイル（インデント、改行コードなど）を統一するための設定ファイルです。
- **`.gitignore`**: Gitのバージョン管理システムが追跡しないファイルやディレクトリ（例: ビルド生成物、一時ファイル）を指定するファイルです。
- **`.vscode/`**: Visual Studio Codeエディタのワークスペース固有の設定を格納するディレクトリです。
    - **`extensions.json`**: このプロジェクトで推奨されるVS Code拡張機能のリストを定義します。
    - **`settings.json`**: VS Codeのワークスペースレベルの設定（例: フォーマッタ、リンター設定）を定義します。
- **`Cargo.lock`**: `Cargo.toml`で指定された依存ライブラリの正確なバージョンとその依存関係ツリーを記録し、再現性のあるビルドを保証するファイルです。
- **`Cargo.toml`**: Rustプロジェクトのメタデータ（プロジェクト名、バージョン、著者など）と、プロジェクトが依存する外部ライブラリを定義するマニフェストファイルです。
- **`LICENSE`**: このプロジェクトのソフトウェアライセンス（MIT License）に関する詳細情報が記載されています。
- **`README.ja.md`**: プロジェクトの目的、機能、使い方、開発方法などを日本語で説明する主要なドキュメントファイルです。
- **`README.md`**: `README.ja.md`を基に自動生成された、プロジェクトの英語での説明書です。
- **`_config.yml`**: 静的サイトジェネレーター（例: Jekyll）で使われる設定ファイルで、ドキュメントサイトの生成などに関連する可能性があります。
- **`generated-docs/`**: 開発状況レポートなど、プロジェクトによって自動生成されたドキュメントが格納されるディレクトリです。
- **`src/`**: プロジェクトの主要なソースコードが格納されているディレクトリです。
    - **`app.rs`**: アプリケーション全体のロジックや状態管理、主要な処理フローを定義するモジュールです。
    - **`cli.rs`**: コマンドラインインターフェース（CLI）の引数解析や、ユーザーからのコマンド入力を処理するロジックを担うモジュールです。
    - **`client_manager.rs`**: バックグラウンドで動作する音楽再生サーバーとの通信（MMLの送信、停止、シャットダウンなど）を管理するモジュールです。
    - **`converter.rs`**: MMLテキストをプログラムが扱える音楽データ構造に変換する、またはその逆の変換ロジックを提供するモジュールです。
    - **`input.rs`**: ユーザーから入力されるMML文字列などのデータを取得し、処理に適した形式に変換するモジュールです。
    - **`main.rs`**: プログラムのエントリーポイントとなるファイルで、アプリケーションの起動と主要な処理の呼び出しを制御します。
    - **`process_manager.rs`**: バックグラウンドで動作する音楽再生サーバープロセスの起動、停止、状態監視などを管理するモジュールです。

## 関数詳細説明
- **`main`関数 (main.rs)**: プログラムの開始点です。コマンドライン引数を解析し、MMLの再生、サーバーの起動・停止・シャットダウンなど、ユーザーの要求に応じた主要な処理を呼び出します。
- **`parse_arguments`関数 (cli.rs)**: コマンドライン引数を解析し、MML文字列や`--stop`、`--shutdown`、`--server`といったオプションを読み取り、アプリケーションが利用しやすい形式に変換して返します。
- **`run_application`関数 (app.rs)**: アプリケーションの中核的な処理を実行します。MMLの解析からオーディオ生成、実際の音声再生、サーバーとの連携までの一連のフローを統括します。
- **`send_mml_to_server`関数 (client_manager.rs)**: クライアントモードで動作している際に、入力されたMML文字列をバックグラウンドの音楽再生サーバーに送信し、演奏を開始させます。
- **`stop_playback`関数 (client_manager.rs)**: サーバーに対して、現在再生中の音楽を停止するよう指示するメッセージを送信します。
- **`shutdown_server`関数 (client_manager.rs)**: サーバーに対して、自身を安全に終了させるよう指示するメッセージを送信し、バックグラウンドプロセスを停止させます。
- **`convert_mml_to_music_data`関数 (converter.rs)**: 解析されたMMLの抽象構文木（AST）を受け取り、それをオーディオ合成ライブラリが利用できる内部的な音楽データ構造に変換します。
- **`get_user_input_mml`関数 (input.rs)**: コマンドライン引数などからユーザーが入力したMML文字列を取得し、後続の処理のために準備します。
- **`start_background_server`関数 (process_manager.rs)**: MMLを解析し音楽を再生するためのサーバープロセスをバックグラウンドで起動します。
- **`is_server_active`関数 (process_manager.rs)**: 現在、バックグラウンドで音楽再生サーバープロセスが動作しているかどうかを確認します。

## 関数呼び出し階層ツリー
```
関数呼び出し階層を分析できませんでした

---
Generated at: 2025-11-18 07:03:31 JST
