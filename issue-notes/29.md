# issue --output foo.wav でwav保存できるか検討する #29
[issues #29](https://github.com/cat2151/cat-play-mml/issues/29)

## 検討結果

### server側ライブラリに機能追加が必要か？

**不要** ❌

`ym2151-log-player-rust`ライブラリには既に`wav_writer`モジュールが実装されており、WAVファイル生成機能が完備されています。

### 実装状況

**実装完了** ✅

シンプルに当アプリでWAV出力ができるようになりました。

## 実装内容

### 追加された機能

- `--output <FILE>` フラグを追加
- MML文字列、MMLファイル、MIDIファイル、YM2151 JSONファイルからWAV生成が可能
- リアルタイム再生の代わりにWAVファイルを出力

### 使用例

```bash
# MML文字列からWAV生成
cat-play-mml --output music.wav cde

# MMLファイルからWAV生成
cat-play-mml --output output.wav input.mml

# より長い曲
cat-play-mml --output song.wav "cdefgabc>c"
```

### WAVファイル仕様

- フォーマット: 16-bit PCM ステレオ
- サンプリングレート: 55930 Hz（OPMネイティブレート）
- 余韻の自動検出と生成
- 進捗表示機能付き

### プラットフォーム対応

- **Windows**: リアルタイム再生 + WAV出力の両方に対応
- **Linux/その他**: WAV出力のみ対応（サーバーモードはWindows専用のため）

### 技術詳細

実装には以下を使用：
- `ym2151_log_player_rust::wav_writer::generate_wav()` - WAV生成
- `ym2151_log_player_rust::player::Player` - 音源エミュレーション
- `ym2151_log_player_rust::events::EventLog` - イベントログ処理

既存のライブラリ機能のみで実装可能だったため、アップストリームへの変更は不要でした。

