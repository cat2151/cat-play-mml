# 実装計画書サマリー

このドキュメントは、`cat-play-mml` プロジェクトの各言語実装の計画をまとめたものです。

## プロジェクト概要

Music Macro Language (MML) をパースして音楽を再生するマルチ言語対応プロジェクトです。

### 基本仕様

- **入力**: MML文字列（例: "cde" でドレミを再生）
- **出力**: リアルタイム音声再生
- **パーサー**: tree-sitterベース（または独自シンプルパーサー）
- **オーディオライブラリ**: 各言語で標準的なものを使用

## 各言語の実装計画

### 1. Python実装

**ステータス**: 実装予定

**詳細**: [src/python/IMPLEMENTATION_PLAN.md](python/IMPLEMENTATION_PLAN.md)

**使用ライブラリ**:
- `sounddevice`: オーディオ出力
- `numpy`: 音声波形生成

**実装方針**:
- シンプルなMMLパーサー（"cde" などの基本音階をサポート）
- サイン波生成による音声合成
- 同期的な音声再生

**見積もり**: 2-3時間

---

### 2. Rust実装

**ステータス**: 実装予定

**詳細**: [src/rust/IMPLEMENTATION_PLAN.md](rust/IMPLEMENTATION_PLAN.md)

**使用ライブラリ**:
- `cpal`: クロスプラットフォームオーディオI/O
- `nom`: パーサーコンビネータ（または独自パーサー）

**実装方針**:
- 型安全なMMLパーサー
- ストリーミング音声生成
- 低レイテンシ再生

**見積もり**: 4-6時間

---

### 3. Go実装

**ステータス**: 実装予定

**詳細**: [src/go/IMPLEMENTATION_PLAN.md](go/IMPLEMENTATION_PLAN.md)

**使用ライブラリ**:
- `oto`: シンプルな低レイテンシオーディオライブラリ
- 標準パッケージでパーサー実装

**実装方針**:
- goroutineを使った並行処理
- チャネルベースのオーディオバッファリング
- シンプルなパーサー実装

**見積もり**: 3-5時間

---

### 4. TypeScript (ブラウザ版) 実装

**ステータス**: 実装予定

**詳細**: [src/typescript/browser/IMPLEMENTATION_PLAN.md](typescript/browser/IMPLEMENTATION_PLAN.md)

**使用API/ライブラリ**:
- Web Audio API: 音声生成・再生
- TypeScript: 型安全な実装

**実装方針**:
- ブラウザで動作するシンプルなWebアプリ
- OscillatorNodeを使った音声生成
- インタラクティブなUI（オプション）

**見積もり**: 3-4時間

---

### 5. TypeScript (Deno版) 実装

**ステータス**: 実装予定

**詳細**: [src/typescript/deno/IMPLEMENTATION_PLAN.md](typescript/deno/IMPLEMENTATION_PLAN.md)

**使用ライブラリ**:
- Denoの標準ライブラリ
- FFI経由でネイティブオーディオライブラリ（例: portaudio）
- または WebAssembly経由でオーディオ処理

**実装方針**:
- CLIアプリケーションとして実装
- FFIまたはWASMでネイティブオーディオライブラリを使用
- ブラウザ版との共通パーサーコード

**見積もり**: 4-6時間

---

## 共通の実装ステップ

各言語実装は以下のステップで進めます：

1. **プロジェクトセットアップ**
   - 依存関係の設定
   - ビルドシステムの構成
   - ディレクトリ構造の作成

2. **MMLパーサーの実装**
   - 基本的な音階（c, d, e, f, g, a, b）
   - オクターブ指定（o4など）（オプション）
   - 音長指定（l4など）（オプション）
   - テンポ指定（t120など）（オプション）

3. **音声生成エンジンの実装**
   - サイン波生成器
   - 周波数計算（A4 = 440Hz基準）
   - 音長からサンプル数への変換

4. **オーディオ出力の実装**
   - オーディオデバイスの初期化
   - バッファリング
   - 再生制御

5. **統合とテスト**
   - "cde" の再生テスト
   - エラーハンドリング
   - ドキュメント作成

## マイルストーン

- **Phase 1**: Python実装（基準実装）
- **Phase 2**: Rust実装
- **Phase 3**: Go実装
- **Phase 4**: TypeScript (ブラウザ版) 実装
- **Phase 5**: TypeScript (Deno版) 実装

## 技術的な課題と解決策

### 1. tree-sitterの統合

**課題**: tree-sitterのセットアップと各言語バインディング

**解決策**:
- Phase 1では独自の単純パーサーを実装
- tree-sitterは後のフェーズで追加（オプション）

### 2. オーディオレイテンシ

**課題**: リアルタイム再生時のレイテンシ

**解決策**:
- 適切なバッファサイズの選択
- 非同期処理の活用

### 3. クロスプラットフォーム対応

**課題**: 各OSでのオーディオライブラリの動作

**解決策**:
- クロスプラットフォームライブラリの選択
- OS固有の問題は既知の問題として文書化

## 成功基準

各言語実装は以下を満たす必要があります：

1. ✅ コマンドライン引数 "cde" でドレミが再生できる
2. ✅ インストール手順が明確に文書化されている
3. ✅ 基本的なエラーハンドリングが実装されている
4. ✅ コードが適切にフォーマットされている
5. ✅ READMEにクイックスタートガイドがある

## 参考リソース

- [Music Macro Language 仕様](https://woolyss.com/chipmusic-mml.php)
- [tree-sitter公式ドキュメント](https://tree-sitter.github.io/tree-sitter/)
- cat-oscillator-sync プロジェクト（参考実装）
